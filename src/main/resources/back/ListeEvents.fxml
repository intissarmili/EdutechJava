<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.effect.DropShadow?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="controller.back.ListeEventController"
            prefHeight="700.0" prefWidth="1000.0"
            style="-fx-background-color: #f5f5f7;">
    <top>
        <VBox spacing="10">
            <padding>
                <Insets top="15" right="20" bottom="15" left="20"/>
            </padding>

            <!-- En-tête avec titre et barre de navigation -->
            <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-background-color: #ffffff; -fx-background-radius: 8;">
                <padding>
                    <Insets top="12" right="15" bottom="12" left="15"/>
                </padding>
                <effect>
                    <DropShadow color="#00000022" radius="5" spread="0.05" />
                </effect>

                <Label text="Gestion des événements" style="-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #2d3748;"/>
                <Region HBox.hgrow="ALWAYS"/>

                <!-- Bouton Calendrier avec icône -->
                <Button fx:id="calendarButton" onAction="#showCalendarView" styleClass="nav-button"
                        style="-fx-background-color: #edf2f7; -fx-background-radius: 4; -fx-padding: 8 12;">
                    <graphic>
                        <HBox spacing="5" alignment="CENTER">
                            <ImageView fitHeight="16.0" fitWidth="16.0" preserveRatio="true">
                                <Image url="@/images/calendar.png"/>
                            </ImageView>
                            <Label text="Calendrier" style="-fx-text-fill: #4a5568; -fx-font-weight: semi-bold;"/>
                        </HBox>
                    </graphic>
                </Button>

                <!-- Bouton Notifications avec compteur -->
                <StackPane alignment="CENTER_RIGHT">
                    <Button fx:id="notificationButton" mnemonicParsing="false"
                            style="-fx-background-color: #edf2f7; -fx-background-radius: 4; -fx-padding: 8 12;">
                        <graphic>
                            <ImageView fx:id="notificationIcon" fitHeight="18.0" fitWidth="18.0" preserveRatio="true">
                                <Image url="@/images/notification.png"/>
                            </ImageView>
                        </graphic>
                    </Button>
                    <Label fx:id="notificationCounter" text="3" translateX="8" translateY="-8"
                           style="-fx-background-color: #e53e3e; -fx-text-fill: white; -fx-background-radius: 10; -fx-padding: 2 6; -fx-font-weight: bold; -fx-font-size: 10px;" />
                </StackPane>
            </HBox>

            <!-- Barre d'outils -->
            <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-padding: 10 0;">
                <!-- Zone de recherche avec style moderne -->
                <HBox spacing="0" alignment="CENTER_LEFT" style="-fx-background-color: white; -fx-background-radius: 6; -fx-border-color: #e2e8f0; -fx-border-radius: 6; -fx-padding: 0 10;" HBox.hgrow="ALWAYS">
                    <ImageView fitHeight="16.0" fitWidth="16.0" preserveRatio="true">
                        <Image url="@/images/search.png"/>
                    </ImageView>
                    <TextField fx:id="searchField" promptText="Rechercher un événement..."
                               style="-fx-background-color: transparent; -fx-padding: 8 5; -fx-pref-width: 300;" />
                    <Button text="Rechercher" onAction="#handleSearch"
                            style="-fx-background-color: #3182ce; -fx-text-fill: white; -fx-background-radius: 4; -fx-font-weight: bold;"/>
                </HBox>

                <!-- Boutons d'action -->
                <Button text="+ Ajouter" onAction="#openAddForm"
                        style="-fx-background-color: #38a169; -fx-text-fill: white; -fx-background-radius: 4; -fx-font-weight: bold; -fx-padding: 8 15;"/>
                <Button text="Exporter" onAction="#handleExport"
                        style="-fx-background-color: #4a5568; -fx-text-fill: white; -fx-background-radius: 4; -fx-padding: 8 15;">
                    <graphic>
                        <ImageView fitHeight="14.0" fitWidth="14.0" preserveRatio="true">
                            <Image url="@/images/export.png"/>
                        </ImageView>
                    </graphic>
                </Button>
                <Button text="Rafraîchir" onAction="#refreshTable"
                        style="-fx-background-color: #edf2f7; -fx-text-fill: #4a5568; -fx-background-radius: 4; -fx-padding: 8 15;">
                    <graphic>
                        <ImageView fitHeight="14.0" fitWidth="14.0" preserveRatio="true">
                            <Image url="@/images/refresh.png"/>
                        </ImageView>
                    </graphic>
                </Button>
            </HBox>

            <!-- Filtres optionnels -->
            <HBox spacing="10" alignment="CENTER_LEFT">
                <Label text="Filtres:" style="-fx-text-fill: #4a5568; -fx-font-weight: bold;"/>
                <ComboBox fx:id="categoryFilter" promptText="Catégorie" prefWidth="150"/>
                <DatePicker fx:id="dateFilter" promptText="Date"/>
                <CheckBox fx:id="activeEventsOnly" text="Événements actifs uniquement" selected="true"/>
                </HBox>
        </VBox>
    </top>

    <center>
        <VBox spacing="10">
            <padding>
                <Insets top="0" right="20" bottom="10" left="20"/>
            </padding>

            <!-- Tableau des événements avec style amélioré -->
            <TableView fx:id="tableView" VBox.vgrow="ALWAYS" style="-fx-background-color: white; -fx-background-radius: 8; -fx-border-color: #e2e8f0; -fx-border-radius: 8;">
                <effect>
                    <DropShadow color="#00000015" radius="3" spread="0.03" />
                </effect>
                <columns>
                    <TableColumn fx:id="colTitle" text="Titre" prefWidth="180"/>
                    <TableColumn fx:id="colDescription" text="Description" prefWidth="220"/>
                    <TableColumn fx:id="colCategory" text="Catégorie" prefWidth="120"/>
                    <TableColumn fx:id="colDateTime" text="Date et Heure" prefWidth="160"/>
                    <TableColumn fx:id="colPhoto" text="Photo" prefWidth="120"/>
                    <TableColumn fx:id="colActions" text="Actions" prefWidth="160"/>
                </columns>
                <placeholder>
                    <VBox alignment="CENTER" spacing="10">
                        <ImageView fitHeight="64.0" fitWidth="64.0" preserveRatio="true">

                        </ImageView>
                        <Label text="Aucun événement trouvé" style="-fx-text-fill: #718096; -fx-font-size: 14px;"/>
                        <Button text="Créer un événement" onAction="#openAddForm"
                                style="-fx-background-color: #3182ce; -fx-text-fill: white; -fx-background-radius: 4;"/>
                    </VBox>
                </placeholder>
            </TableView>

            <!-- Pagination -->
            <HBox alignment="CENTER" spacing="15" style="-fx-padding: 10 0;">
                <Label fx:id="pageInfoLabel" text="Affichage de 1-10 sur 42 événements" style="-fx-text-fill: #718096;"/>
                <Pagination fx:id="pagination" pageCount="5" currentPageIndex="0" maxPageIndicatorCount="5" />
                <ComboBox fx:id="rowsPerPageCombo" prefWidth="100" promptText="10 par page"/>
            </HBox>
        </VBox>
    </center>

    <bottom>
        <VBox style="-fx-background-color: white; -fx-border-color: #e2e8f0; -fx-border-width: 1 0 0 0;">
            <padding>
                <Insets top="10" right="20" bottom="10" left="20"/>
            </padding>
            <Label text="Événements à venir" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #2d3748;"/>
            <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-padding: 5 0;">
                <FlowPane fx:id="eventsContainer" hgap="15" vgap="15" style="-fx-padding: 10;">
                    <!-- Les cartes d'événements seront ajoutées ici dynamiquement -->
                </FlowPane>
            </ScrollPane>
        </VBox>
    </bottom>
</BorderPane>